<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Visual (HTML)</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <style>
    :root{
      --bg:#0b1220; --panel:#121a2b; --muted:#97a1b5; --text:#e7edf7;
      --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; --primary:#60a5fa; --line:#22304a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background:linear-gradient(180deg,#071022, #0c1529 40%, #0b1220);
      color:var(--text);
    }
    header{
      display:flex; align-items:center; gap:12px; padding:18px 20px; border-bottom:1px solid #1c2740;
      position:sticky; top:0; backdrop-filter:saturate(140%) blur(6px); background:rgba(11,18,32,.7);
    }
    header h1{font-size:18px; margin:0; letter-spacing:.4px}
    .container{padding:20px; max-width:1180px; margin:0 auto}
    .grid{
      display:grid; gap:16px;
      grid-template-columns: repeat(12, 1fr);
    }
    .card{
      background:linear-gradient(180deg, #121a2b, #0f182a);
      border:1px solid #1c2740; border-radius:12px; padding:16px; box-shadow: 0 1px 0 #000 inset, 0 0 20px rgba(0,0,0,.2);
    }
    .kpis{grid-column:1 / -1; display:grid; grid-template-columns:repeat(4,1fr); gap:12px}
    .kpi h3{margin:0 0 8px; font-size:12px; color:var(--muted); font-weight:600; letter-spacing:.6px; text-transform:uppercase}
    .kpi .value{font-size:28px; font-weight:700; display:flex; align-items:baseline; gap:8px}
    .trend{font-size:12px; padding:2px 6px; border-radius:999px; background:#0d1b2f; border:1px solid #20304d; color:var(--muted)}
    .trend.up{color:#a7f3d0; border-color:#1f513a; background:#0e2a22}
    .trend.down{color:#fecaca; border-color:#5a1d1d; background:#2a1212}

    .col-4{grid-column:span 4}
    .col-8{grid-column:span 8}
    .col-6{grid-column:span 6}
    .col-12{grid-column:span 12}

    /* Gauge circular */
    .gauge-wrap{display:flex; align-items:center; gap:16px}
    .gauge{
      --p:72; /* porcentaje */
      width:120px; aspect-ratio:1/1; border-radius:50%;
      background:
        radial-gradient(closest-side, #0b1220 76%, transparent 77% 100%),
        conic-gradient(var(--ok) calc(var(--p)*1%), #1e2a44 0);
      display:grid; place-items:center; position:relative; border:1px solid #1c2740;
      box-shadow:inset 0 0 20px #0a1327;
    }
    .gauge > span{font-size:22px; font-weight:800}
    .gauge small{display:block; font-size:11px; color:var(--muted); margin-top:2px; letter-spacing:.3px}

    /* Timeline */
    .timeline{position:relative; margin:0; padding:0 0 0 24px; list-style:none}
    .timeline:before{content:""; position:absolute; left:10px; top:0; bottom:0; width:2px; background:var(--line)}
    .timeline li{position:relative; margin:0 0 14px}
    .timeline li:before{
      content:""; position:absolute; left:-2px; top:4px; width:10px; height:10px; border-radius:50%;
      background:var(--primary); box-shadow:0 0 0 3px rgba(96,165,250,.15)
    }
    .timeline time{font-size:12px; color:var(--muted)}
    .pill{display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px; border:1px solid #2a3a5e; background:#0f1a30; color:#a9b4c8}
    .pill.ok{border-color:#1f513a; color:#a7f3d0; background:#0e2a22}
    .pill.warn{border-color:#5b4609; color:#fde68a; background:#2a200e}

    /* Mermaid panel */
    .mermaid{background:#0e1526; border:1px solid #1c2740; border-radius:12px; padding:8px}

    /* Responsive */
    @media (max-width: 980px){
      .kpis{grid-template-columns:1fr 1fr}
      .col-8,.col-6,.col-4{grid-column:1 / -1}
    }
  </style>
</head>
<body>
  <header>
    <svg width="20" height="20" viewBox="0 0 24 24" fill="#60a5fa" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.91 1.19 6.96L12 17.77l-6.19 3.37L7 14.18l-5-4.91 6.91-1.01z"/></svg>
    <h1>Dashboard Visual (HTML)</h1>
  </header>

  <div class="container">
    <!-- KPIs -->
    <section class="grid card kpis">
      <div class="kpi">
        <h3>Disponibilidad</h3>
        <div class="value">98.7% <span class="trend up">▲ +0.4%</span></div>
        <small class="muted">Últimas 24h</small>
      </div>
      <div class="kpi">
        <h3>Producción</h3>
        <div class="value">12,430 <span class="trend up">▲ +3.1%</span></div>
        <small class="muted">Unidades</small>
      </div>
      <div class="kpi">
        <h3>Alarmas</h3>
        <div class="value">7 <span class="trend down">▼ -2</span></div>
        <small class="muted">Críticas: 1</small>
      </div>
      <div class="kpi">
        <h3>Anclajes Blockchain</h3>
        <div class="value">15 <span class="trend up">▲ +5</span></div>
        <small class="muted">Hoy</small>
      </div>
    </section>

    <div class="grid" style="margin-top:16px">
      <!-- Gauge + texto -->
      <section class="card col-4">
        <h2 style="margin:0 0 10px;font-size:16px">Salud del Activo</h2>
        <div class="gauge-wrap">
          <div class="gauge" id="gauge" aria-label="Salud 72%"><span id="gaugeVal">72%</span></div>
          <div>
            <div class="pill ok">OK</div>
            <p style="margin:8px 0 6px; color:var(--muted)">Basado en vibración, temp. y horas de servicio.</p>
            <label style="font-size:12px;color:var(--muted)">Ajustar %:
              <input id="gaugeInput" type="range" min="0" max="100" value="72" />
            </label>
          </div>
        </div>
      </section>

      <!-- Chart.js -->
      <section class="card col-8">
        <h2 style="margin:0 0 10px;font-size:16px">Serie temporal (sensor)</h2>
        <canvas id="sensorChart" height="90" aria-label="Gráfica de sensor"></canvas>
      </section>

      <!-- Timeline -->
      <section class="card col-6">
        <h2 style="margin:0 0 10px;font-size:16px">Timeline de eventos</h2>
        <ul class="timeline" id="timeline">
          <li>
            <time>10:12</time> — Lectura fuera de rango <span class="pill warn">Warning</span><br/>
            <details><summary>Detalles</summary>Temperatura pico 92.4°C en Cabezal A.</details>
          </li>
          <li>
            <time>10:10</time> — Anclaje on-chain <span class="pill">CID QmXZ…</span><br/>
            <details><summary>Ver hash</summary>0x3b4c9b1c2a2e7a6d4f88b8ad7b9c0fdca9b0a1c6f4e7d2c913…</details>
          </li>
          <li>
            <time>09:55</time> — Orden de mantenimiento aprobada <span class="pill ok">OK</span>
          </li>
        </ul>
      </section>

      <!-- Mermaid diagram -->
      <section class="card col-6">
        <h2 style="margin:0 0 10px;font-size:16px">Flujo de datos</h2>
        <pre class="mermaid">
graph LR
  A[Sensor/PLC] --> B[Gemelo Digital]
  B --> C[(Almacenamiento Off-chain)]
  C -->|CID+hash| D[[Smart Contract]]
  D --> E{Auditoría}
  B --> F[Panel HTML]
  D --> F
        </pre>
      </section>

      <!-- Tabla simple -->
      <section class="card col-12">
        <h2 style="margin:0 0 10px;font-size:16px">Últimos anclajes</h2>
        <div style="overflow:auto">
          <table style="width:100%; border-collapse:collapse">
            <thead>
              <tr style="text-align:left; font-size:12px; color:var(--muted); border-bottom:1px solid #1c2740">
                <th style="padding:8px">Fecha</th>
                <th style="padding:8px">Twin</th>
                <th style="padding:8px">CID</th>
                <th style="padding:8px">Hash</th>
                <th style="padding:8px">Estado</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </section>
    </div>
  </div>

  <!-- Libs de terceros livianas por CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <script>
    // Mermaid
    mermaid.initialize({ startOnLoad: true, theme: "dark" });

    // Gauge interactivo
    const gauge = document.getElementById('gauge');
    const gaugeVal = document.getElementById('gaugeVal');
    const gaugeInput = document.getElementById('gaugeInput');
    gaugeInput.addEventListener('input', e=>{
      const v = +e.target.value;
      gauge.style.setProperty('--p', v);
      gaugeVal.textContent = v + '%';
      gauge.setAttribute('aria-label', 'Salud ' + v + '%');
    });

    // Datos de ejemplo para Chart.js
    const labels = ["09:30","09:40","09:50","10:00","10:10","10:20","10:30"];
    const data = {
      labels,
      datasets: [{
        label: "Temperatura °C",
        data: [68.2, 70.1, 72.0, 76.3, 81.9, 78.4, 74.1],
        borderColor: "#60a5fa",
        backgroundColor: "rgba(96,165,250,.18)",
        tension: .25,
        fill: true,
        pointRadius: 2
      }]
    };
    const ctx = document.getElementById('sensorChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data,
      options: {
        responsive: true,
        scales: {
          y: { grid: { color: "#22304a" }, ticks:{ color:"#a9b4c8" } },
          x: { grid: { color: "#1b263f" }, ticks:{ color:"#8fa3c4" } }
        },
        plugins: {
          legend:{ labels:{ color:"#c8d3e6" } },
          tooltip:{ backgroundColor:"#0f1a30", borderColor:"#20304d", borderWidth:1 }
        }
      }
    });

    // Tabla: filas de ejemplo
    const rows = document.getElementById('rows');
    const sample = [
      {ts:"2025-09-09 10:10", twin:"Cabezal-A", cid:"QmXZ…1f", hash:"0x3b4c…c913", estado:"OK"},
      {ts:"2025-09-09 09:45", twin:"Cabezal-A", cid:"QmdE…9a", hash:"0x7af1…b02e", estado:"OK"},
      {ts:"2025-09-09 09:10", twin:"Bomba-2",   cid:"QmQ2…77", hash:"0x12ce…091d", estado:"OK"}
    ];
    rows.innerHTML = sample.map(r=>`
      <tr style="border-bottom:1px solid #16223b">
        <td style="padding:8px">${r.ts}</td>
        <td style="padding:8px">${r.twin}</td>
        <td style="padding:8px; font-family:ui-monospace, SFMono-Regular, Menlo, monospace">${r.cid}</td>
        <td style="padding:8px; font-family:ui-monospace, SFMono-Regular, Menlo, monospace">${r.hash}</td>
        <td style="padding:8px"><span class="pill ok">${r.estado}</span></td>
      </tr>
    `).join('');
  </script>
</body>
</html>
